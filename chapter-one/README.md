# Chapter One

## Demand

设想有一个戏剧演出团，演员们经常去各种场合表演戏剧。通常客户（Customer）会指定几出剧目，而剧团则根据观众（Audience）人数及剧目类型来向客户收费。该剧团目前出演两种戏剧：悲剧（tragedy）和喜剧（comedy）。给客户发出账单时，剧团还会根据到场观众的数量给出“观众量积分”(volume creit)优惠，下次客户再请剧团表演时可以使用积分获得折扣 ———— 你可以把这看作一种提升客户忠诚度的方式。

- 定价方式：
  - 喜剧：剧目价 + 300/人；如果人数超过 20 人，超过的部分的人收 剧目价 + 10000 + 500/人
  - 悲剧：剧目价；如果超过 30 人，再多收 剧目价 + 1000/人
- 观众量积分：
  - 悲剧：30 人以内 取每场的观众量
  - 戏剧：观众量 + 观众量的 20%

## Analyze

客户请戏剧团来表演几出剧，剧团会以每出剧的人数和剧目类型向客户收费；
表演结束后，开出账单时，还会根据到场人数给出“观众量积分”优惠，下一次客户再请剧团表演时可以使用积分获得折扣。

### 关键信息：

- 剧团目前会出演两种类型的剧目： 悲剧 tragedy 和 喜剧 comedy
- 账单内容：观众数 audience count 和 剧目类型 play type 和 到场观众数 volume creit（附加）

## Tasking

1. 客户有一个下单的行为，但是由于这个场景里面客户并不是主角，所以我设计由戏剧团（troupe）提供这个下订单的入口。也就是说调用 troupe.order(demand)完成下单步骤

- 客户先看剧团的剧目单，了解有哪些剧和单价
- 选出自己想看的剧以及预订的观众数，进行下单

## 技术栈

- Typescript
- vitest

## Process

1. setup
   - pnpm init -y
   - pnpm add -D vitest
2. 小步骤开发

   - 拆分大任务，一个 test 对应一个小任务

3. TDD 流程
   - 编写不通过的小步骤的测试案例
   - 快速开发让测试案例通过的代码，直接伪实现，测试用例需要返回啥，代码就返回啥
   - 将伪实现转变成真正的实现，分析返回结果的来源，完成第一步可以通过的代码
   - 去除代码里的坏味道，重构
