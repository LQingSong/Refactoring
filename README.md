# 重构-改善既有代码设计 读书记录

### 类应该包含它的测试代码，你会感谢这一步流程，它会帮你减少后期大量的代码检查 bug 的所花费的时间

## 测试驱动开发的编程方式依赖于下面这个短循环：

- 先编写一个(失败的)测试
- 编写代码使测试通过
- 然后进行重构以保证代码整洁

### happy path "正常路径"，它指的是一切工作正常、用户使用方式也最符合规范的那种场景。

### sad path "探索程序边界" 考虑可能出错的边界条件，把测试火力集中在那儿；积极思考如何破坏代码

### 任何测试都不能证明一个程序没有 bug,但这并不影响”测试可以提高编程速度“

### 如果你要给程序添加一个特性，但发现代码因缺乏良好的结构难以下手更改，那就先重构那个程序，使其容易添加该属性，然后再添加该属性。

### 每当要进行重构的时候，第一个步骤永远相同：得确保即将修改的代码拥有一组可靠的测试，毕竟是人为去重构代码，程序越大，不小心破坏其他代码的可能性就越大。

重构前，先检查自己是否有一套可靠的测试集，这些测试必须有自我检验能力。
把想要达成的目标写两遍——测试里写一遍，代码里写一遍——我就得犯两遍同样得错误才能骗过检测器。这降低了我犯错的概率，因为我对工作进行了二次确认。尽管编写测试需要花费时间，但却为我节省下客观的调试时间。

### 构筑测试体系对重构来说实在太重要了。

### 重构技术就是以微小的步伐修改程序。如果你犯下错误，很容易便可发现它。

## 常见重构手法:

- 提炼函数。某些语言具备可自动完成的功能，Javascript 工具目前暂不支持，仍需要手动重构。  
  提炼完函数，看看是否能进一步提升其表达能力。一般做的第一件事就是给一些变量改名，使其更简洁。
- 查询取代临时变量
- 改变函数声明
  - format 函数命名不够直观，formatAsUSD 又太长，改成 usd，同时把美分除以 100 得到美元放到 usd 函数中
- 使用内联变量完全移除中间变量
- 拆分循环分离出累加过程
  - 可能拆分后的程序由原来一个循环变成了好几个循环，但是在重构前期我们仍然坚持拆分循环，先保证好的代码结构

##
